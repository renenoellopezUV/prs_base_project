generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model BroadAncestryCategory {
  id                          Int                           @id @default(autoincrement())
  symbol                      String
  label                       String
  BroadAncestryInModel        BroadAncestryInModel[]
  BroadAncestryInRefPop       BroadAncestryInRefPop[]
  DevelopmentPopulationSample DevelopmentPopulationSample[]
  EvaluationPopulationSample  EvaluationPopulationSample[]
}

model BroadAncestryInModel {
  percentage            Float
  broadAncestryId       Int
  prsModelId            Int
  BroadAncestryCategory BroadAncestryCategory @relation(fields: [broadAncestryId], references: [id])
  PRSModel              PRSModel              @relation(fields: [prsModelId], references: [id])

  @@id([broadAncestryId, prsModelId])
  @@index([prsModelId], map: "BroadAncestryInModel_prsModelId_fkey")
}

model BroadAncestryInRefPop {
  percentage            Float
  broadAncestryId       Int
  referencePopulationId Int
  BroadAncestryCategory BroadAncestryCategory @relation(fields: [broadAncestryId], references: [id])
  ReferencePopulation   ReferencePopulation   @relation(fields: [referencePopulationId], references: [id])

  @@id([broadAncestryId, referencePopulationId])
  @@index([referencePopulationId], map: "BroadAncestryInRefPop_referencePopulationId_fkey")
}

model DevelopmentPopulationSample {
  id                    Int                              @id @default(autoincrement())
  numberOfIndividuals   Int
  numberOfCases         Int
  numberOfControls      Int
  percentMale           Float
  age                   Float
  ageUnits              String
  ancestryBroad         String
  ancestryDetails       String
  cohort                String
  gcId                  String?
  sourcePMID            String?
  sourceDOI             String?
  role                  DevelopmentPopulationSample_role
  prsModelId            Int
  broadAncestryId       Int
  BroadAncestryCategory BroadAncestryCategory            @relation(fields: [broadAncestryId], references: [id])
  PRSModel              PRSModel                         @relation(fields: [prsModelId], references: [id])

  @@index([broadAncestryId], map: "DevelopmentPopulationSample_broadAncestryId_fkey")
  @@index([prsModelId], map: "DevelopmentPopulationSample_prsModelId_fkey")
}

model EvaluationPopulationSample {
  id                    Int                   @id @default(autoincrement())
  numberOfIndividuals   Int
  numberOfCases         Int
  numberOfControls      Int
  percentMale           Float
  age                   Float
  ageUnits              String
  ancestryBroad         String
  ancestryDetails       String
  cohort                String
  gcId                  String?
  sourcePMID            String?
  sourceDOI             String?
  phenotypeFree         String
  pssId                 String?
  broadAncestryId       Int
  BroadAncestryCategory BroadAncestryCategory @relation(fields: [broadAncestryId], references: [id])
  ModelEvaluation       ModelEvaluation[]

  @@index([broadAncestryId], map: "EvaluationPopulationSample_broadAncestryId_fkey")
}

model ModelEvaluation {
  id                           Int                           @id @default(autoincrement())
  reportedTrait                String
  covariates                   String?
  ppmId                        String?
  prsModelId                   Int
  publicationId                Int
  evaluationPopulationSampleId Int
  EvaluationPopulationSample   EvaluationPopulationSample    @relation(fields: [evaluationPopulationSampleId], references: [id])
  PRSModel                     PRSModel                      @relation(fields: [prsModelId], references: [id])
  Publication                  Publication                   @relation(fields: [publicationId], references: [id])
  PerformanceMetricEvaluation  PerformanceMetricEvaluation[]

  @@index([evaluationPopulationSampleId], map: "ModelEvaluation_evaluationPopulationSampleId_fkey")
  @@index([prsModelId], map: "ModelEvaluation_prsModelId_fkey")
  @@index([publicationId], map: "ModelEvaluation_publicationId_fkey")
}

model PRSAnalysis {
  id                    Int                            @id @default(autoincrement())
  name                  String
  description           String?
  userId                String?
  date                  String
  status                String
  HTMLResultPath        String
  patientFormat         String
  ancestryThreshold     Int
  overlapThreshold      Int
  ancestryAdjustment    PRSAnalysis_ancestryAdjustment
  assembly              PRSAnalysis_assembly
  patientId             Int
  referencePopulationId Int
  Patient               Patient                        @relation(fields: [patientId], references: [id])
  ReferencePopulation   ReferencePopulation            @relation(fields: [referencePopulationId], references: [id])
  PrioritizedModel      PrioritizedModel[]

  @@index([patientId], map: "PRSAnalysis_patientId_fkey")
  @@index([referencePopulationId], map: "PRSAnalysis_referencePopulationId_fkey")
}

model PRSModel {
  id                          Int                           @id @default(autoincrement())
  name                        String
  numberOfSNP                 Int?
  pgscId                      String?                       @unique
  pgscURL                     String?                       @unique
  publicationId               Int
  BroadAncestryInModel        BroadAncestryInModel[]
  DevelopmentPopulationSample DevelopmentPopulationSample[]
  ModelEvaluation             ModelEvaluation[]
  Publication                 Publication                   @relation(fields: [publicationId], references: [id])
  PRSModelToTrait             PRSModelToTrait[]
  PrioritizedModel            PrioritizedModel[]
  ScoringFile                 ScoringFile?

  @@index([publicationId], map: "PRSModel_publicationId_fkey")
}

model PRSModelToTrait {
  prsModelId Int
  traitId    Int
  PRSModel   PRSModel @relation(fields: [prsModelId], references: [id])
  Trait      Trait    @relation(fields: [traitId], references: [id])

  @@id([prsModelId, traitId])
  @@index([traitId], map: "PRSModelToTrait_traitId_fkey")
}

model PRSResult {
  id               Int              @id @default(autoincrement())
  prs              Float
  percentile       String
  overlapPercent   Float
  prsModelId       Int
  prsAnalysisId    Int
  PrioritizedModel PrioritizedModel @relation(fields: [prsModelId, prsAnalysisId], references: [prsModelId, prsAnalysisId])

  @@unique([prsModelId, prsAnalysisId])
}

model Patient {
  id               Int           @id @default(autoincrement())
  patientId        String
  VCFFilePath      String
  genotypingMethod String?
  PRSAnalysis      PRSAnalysis[]
}

model PerformanceMetric {
  id                          Int                           @id @default(autoincrement())
  nameShort                   String
  nameLong                    String?
  type                        PerformanceMetric_type
  PerformanceMetricEvaluation PerformanceMetricEvaluation[]
}

model PerformanceMetricEvaluation {
  id                  Int               @id @default(autoincrement())
  estimate            Float
  CILower             Float?
  CIUpper             Float?
  modelEvaluationId   Int
  performanceMetricId Int
  ModelEvaluation     ModelEvaluation   @relation(fields: [modelEvaluationId], references: [id])
  PerformanceMetric   PerformanceMetric @relation(fields: [performanceMetricId], references: [id])

  @@index([modelEvaluationId], map: "PerformanceMetricEvaluation_modelEvaluationId_fkey")
  @@index([performanceMetricId], map: "PerformanceMetricEvaluation_performanceMetricId_fkey")
}

model PrioritizedModel {
  position      Int
  prsModelId    Int
  prsAnalysisId Int
  prsResultId   Int?
  PRSResult     PRSResult?
  PRSAnalysis   PRSAnalysis @relation(fields: [prsAnalysisId], references: [id])
  PRSModel      PRSModel    @relation(fields: [prsModelId], references: [id])

  @@id([prsModelId, prsAnalysisId])
  @@index([prsAnalysisId], map: "PrioritizedModel_prsAnalysisId_fkey")
}

model Publication {
  id              Int               @id @default(autoincrement())
  title           String
  journal         String
  author          String
  date            DateTime?
  year            Int
  PMID            String?           @unique
  DOI             String?           @unique
  pgpId           String?           @unique
  ModelEvaluation ModelEvaluation[]
  PRSModel        PRSModel[]
}

model ReferencePopulation {
  id                    Int                          @id @default(autoincrement())
  name                  String
  description           String?
  studyURL              String?
  assembly              ReferencePopulation_assembly
  BroadAncestryInRefPop BroadAncestryInRefPop[]
  PRSAnalysis           PRSAnalysis[]
}

model ScoringFile {
  id         Int                  @id @default(autoincrement())
  assembly   ScoringFile_assembly
  path       String
  prsModelId Int                  @unique
  PRSModel   PRSModel             @relation(fields: [prsModelId], references: [id])
}

model Trait {
  id                   Int                    @id @default(autoincrement())
  label                String
  description          String?
  URL                  String?
  efoId                Int?                   @unique
  mondoId              String?                @unique
  hpoId                String?                @unique
  orphaId              String?                @unique
  PRSModelToTrait      PRSModelToTrait[]
  TraitToTraitCategory TraitToTraitCategory[]
}

model TraitCategory {
  id                   Int                    @id @default(autoincrement())
  label                String
  TraitToTraitCategory TraitToTraitCategory[]
}

model TraitToTraitCategory {
  traitId         Int
  traitCategoryId Int
  TraitCategory   TraitCategory @relation(fields: [traitCategoryId], references: [id])
  Trait           Trait         @relation(fields: [traitId], references: [id])

  @@id([traitId, traitCategoryId])
  @@index([traitCategoryId], map: "TraitToTraitCategory_traitCategoryId_fkey")
}

enum ScoringFile_assembly {
  GRCh37
  GRCh38
}

enum PerformanceMetric_type {
  RISK_ASSOCIATION
  DISCRIMINATING_POWER
  OTHER
}

enum ReferencePopulation_assembly {
  GRCh37
  GRCh38
}

enum PRSAnalysis_ancestryAdjustment {
  CONTINUOUS
  DISCONTINUOUS
}

enum PRSAnalysis_assembly {
  GRCh37
  GRCh38
}

enum DevelopmentPopulationSample_role {
  BASE
  TUNING
}
